<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Documentation for the soil relaxation &mdash; soil_simulator  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation for utility functions" href="utils.html" />
    <link rel="prev" title="Documentation for the movement of intersecting soil cells" href="intersecting_cells.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            soil_simulator
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="grid.html">Grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="bucket.html">Bucket</a></li>
<li class="toctree-l1"><a class="reference internal" href="body_soil.html">Body soil</a></li>
<li class="toctree-l1"><a class="reference internal" href="intersecting_cells.html">Intersecting cells</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Relax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-description">General description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terrain-relaxation">Terrain relaxation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#description-of-the-different-cases">Description of the different cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#impact-area">Impact area</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bucket-soil-relaxation">Bucket soil relaxation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Description of the different cases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">soil_simulator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Documentation for the soil relaxation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/relax.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="documentation-for-the-soil-relaxation">
<span id="relax"></span><h1>Documentation for the soil relaxation<a class="headerlink" href="#documentation-for-the-soil-relaxation" title="Permalink to this heading"></a></h1>
<p>The fourth task of this simulator is to model soil dynamics.
Various models of different complexities have been developed over the years for this purpose.
As this simulator focuses on performance, a simplified model is therefore employed.
The model assumes that when the local slope of the soil exceeds its repose angle, the soil becomes unstable and needs to avalanche to neighbouring cells to achieve a stable state where the local slope matches the repose angle.
This action is referred to as “relaxation” in this simulator.</p>
<p>This soil relaxation process consists of two main steps:</p>
<ul class="simple">
<li><p>Terrain relaxation, where unstable soil cells on the terrain are relaxed, potentially causing avalanches onto the bucket.</p></li>
<li><p>Bucket soil relaxation, where unstable soil cells on the bucket are relaxed, potentially causing avalanches onto the terrain.</p></li>
</ul>
<p>It is important to note that the relaxation of soil cells can sometimes trigger instability in neighbouring cells.
As a result, the relaxation process needs to be repeated multiple times to achieve an equilibrium state.
In practice, several thousand iterations may be required to reach full equilibrium, although the overall shape of the terrain can often be obtained after just a few iterations.
To balance computational efficiency and accuracy, the algorithm does not wait for a complete equilibrium state and instead stops after a set number of iterations, which can be specified by the <code class="code docutils literal notranslate"><span class="pre">max_iterations_</span></code> field of the <code class="code docutils literal notranslate"><span class="pre">SimParam</span></code> class.
The appropriate value for <code class="code docutils literal notranslate"><span class="pre">max_iterations_</span></code> typically ranges from 1 to 20 and should be chosen based on the specific simulation requirements.
It is worth noting that increasing the value of <code class="code docutils literal notranslate"><span class="pre">max_iterations_</span></code> impacts significantly the performance of the simulator.</p>
<section id="general-description">
<h2>General description<a class="headerlink" href="#general-description" title="Permalink to this heading"></a></h2>
<p>While the detailed implementation of the relaxation process differs for terrain relaxation and bucket soil relaxation, the core algorithm remains the same and will be described in this section.</p>
<p>The relaxation process consists of three steps.</p>
<p>The first step is to identify potentially unstable soil cells.
This initial selection is not intended to be precise but rather to exclude cells that are obviously stable.
To avoid asymmetrical results, the list of potential unstable cells is randomized.
The soil cells in this list are then processed iteratively.</p>
<p>The second step is to check the stability of each considered soil cell in relation to its neighbouring cells.
By convention, relaxation is only performed in the X and Y directions, involving four adjacent cells and excluding diagonal cells.
This choice is based on initial testing, which revealed that relaxing soil in 4 or 8 directions produced visually identical results.
Relaxing in 8 directions allows for convergence to full equilibrium in less iterations than when relaxing in 4 directions, while requiring more computational time to perform each iteration.
As a result, relaxing only in the X and Y directions produces a faster and simpler code.
To avoid asymmetrical results, the order in which neighbouring soil cells are checked is randomized.
The result of this check is a status code consisting of two digits, providing a detailed indication of the condition of the soil cell.</p>
<p>The third step is the actual relaxation, which occurs only if the soil cell is determined to be unstable based on the status code obtained in the previous step.
The relaxation process follows the specific instructions defined by the status code.
The relaxation techniques for terrain relaxation and bucket soil relaxation will be explained separately in the following sections.</p>
<p>It is worth noting that the second and third steps could potentially be merged.
However, separating these two steps improves code testability and maintainability.</p>
</section>
<section id="terrain-relaxation">
<h2>Terrain relaxation<a class="headerlink" href="#terrain-relaxation" title="Permalink to this heading"></a></h2>
<p>This is done by the <code class="code docutils literal notranslate"><span class="pre">RelaxTerrain</span></code> function in the <code class="code docutils literal notranslate"><span class="pre">relax.cpp</span></code> file.
Note that the meaning of the two-digit codes given by the function <code class="code docutils literal notranslate"><span class="pre">CheckUnstableTerrainCell</span></code> and used by the function <code class="code docutils literal notranslate"><span class="pre">RelaxUnstableTerrainCell</span></code> is explained in the docstring of the function <code class="code docutils literal notranslate"><span class="pre">CheckUnstableTerrainCell</span></code>.
In this section, the main focus is to explain the physical reasoning behind the implementation of the <code class="code docutils literal notranslate"><span class="pre">RelaxUnstableTerrainCell</span></code> function.</p>
<section id="description-of-the-different-cases">
<h3>Description of the different cases<a class="headerlink" href="#description-of-the-different-cases" title="Permalink to this heading"></a></h3>
<p>Mainly four different cases are possible, as illustrated in the vertical slice diagram below.
Note that, for illustration purposes, it is assumed that the repose angle allows only for one cell difference between
neighbouring cells.</p>
<img alt="_images/relax_terrain.png" src="_images/relax_terrain.png" />
<p>(a) In this case, there is no bucket.
The soil can freely avalanche to the neighbouring cell, reaching a stable configuration.</p>
<p>(b) In this case, there is some space available below the bucket.
The soil can avalanche into that position to fill the gap.
Note that the soil column would still be unstable after this movement, requiring a second iteration to reach a stable configuration.</p>
<p>(c) In this case, there is enough space available below the bucket to reach a stable configuration.
The soil fully avalanches to that position.</p>
<p>(d) In this case, the soil can avalanche on the top of the bucket and reach a stable configuration.
Note that this is the only case in the simulator where soil from the terrain can be transferred to the bucket.
Consequently, all bucket soil is generated from this case.</p>
<p>It is worth mentioning that the order of these cases is important, as case (d) will only occur if cases (b) and (c) are not possible.
Moreover, if two bucket layers are present, soil avalanches on the top bucket layer only if there is no space available between the two bucket layers.
In other words, avalanching on the bottom layer has priority over avalanching on the top layer.</p>
</section>
<section id="impact-area">
<h3>Impact area<a class="headerlink" href="#impact-area" title="Permalink to this heading"></a></h3>
<p>For performance optimization, the simulator only checks for soil instability within the lateral area specified by the <code class="code docutils literal notranslate"><span class="pre">impact_area_</span></code> field of the <code class="code docutils literal notranslate"><span class="pre">SimOut</span></code> class.
The <code class="code docutils literal notranslate"><span class="pre">impact_area_</span></code> is a union of two areas: the <code class="code docutils literal notranslate"><span class="pre">bucket_area_</span></code>, which corresponds to the lateral area where the bucket is located, and the <code class="code docutils literal notranslate"><span class="pre">relax_area_</span></code>, which corresponds to the lateral area where unstable soil has been identified in the previous step.
By limiting the analysis to this specific region, the simulator achieves significant performance gains and becomes almost independent of the grid size.</p>
</section>
</section>
<section id="bucket-soil-relaxation">
<h2>Bucket soil relaxation<a class="headerlink" href="#bucket-soil-relaxation" title="Permalink to this heading"></a></h2>
<p>This is done by the <code class="code docutils literal notranslate"><span class="pre">RelaxBodySoil</span></code> function in the <code class="code docutils literal notranslate"><span class="pre">relax.cpp</span></code> file.
Note that the meaning of the two-digit codes given by the function <code class="code docutils literal notranslate"><span class="pre">CheckUnstableBodyCell</span></code> and used by the function <code class="code docutils literal notranslate"><span class="pre">RelaxUnstableBodyBell</span></code> is explained in the docstring of the function <code class="code docutils literal notranslate"><span class="pre">CheckUnstableBodyCell</span></code>.
In this section, the main focus is to explain the physical reasoning behind the implementation of the <code class="code docutils literal notranslate"><span class="pre">RelaxUnstableBodyBell</span></code> function.</p>
<section id="id1">
<h3>Description of the different cases<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>Mainly four different cases are possible, as illustrated in the vertical slice diagram below.
Note that, for illustration purposes, it is assumed that the repose angle allows only for one cell difference between
neighbouring cells.</p>
<img alt="_images/relax_body_soil.png" src="_images/relax_body_soil.png" />
<p>(a) In this case, there is no bucket.
The soil can freely avalanche to the neighbouring cell, reaching a stable configuration.</p>
<p>(b) In this case, there is one bucket layer.
The soil can freely avalanche onto the bucket, forming a stable configuration.</p>
<p>(c) In this case, there is one bucket layer.
The soil can avalanche from one bucket layer to another, forming a stable configuration.</p>
<p>(d) In this case, there are two bucket layers.
The soil can avalanche to one of the two adjacent bucket layer.
Note that the top bucket layer has priority in the case where the soil can avalanche to both bucket layer, while, in the case where the soil should avalanche on the bottom layer, there may not be enough space for all the soil to avalanche, leading to a final state that may not be in equilibrium.</p>
<p>It is important to note that the presence of the bucket at the base of the soil column adds complexity to the relaxation process.
There are cases where all the soil on a bucket layer can avalanche, while in other cases, only a portion of the soil may avalanche.
It is crucial to handle these cases appropriately to ensure mass conservation during the relaxation process.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intersecting_cells.html" class="btn btn-neutral float-left" title="Documentation for the movement of intersecting soil cells" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="utils.html" class="btn btn-neutral float-right" title="Documentation for utility functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Vilella Kenny.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v1.0.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      <dd><a href="relax.html">v1.0.0</a></dd>
      <dd><a href="../main/relax.html">main</a></dd>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>