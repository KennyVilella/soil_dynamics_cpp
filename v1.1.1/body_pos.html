<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Determination of the body position &mdash; soil_simulator  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation for the update of the soil resting on the body" href="body_soil.html" />
    <link rel="prev" title="Documentation for the bulldozer blade" href="blade.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            soil_simulator
          </a>
              <div class="version">
                1.1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="grid.html">Grid</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="body.html">Body</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="body.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="bucket.html">Bucket</a></li>
<li class="toctree-l2"><a class="reference internal" href="blade.html">Blade</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Body position</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="body_soil.html">Body soil</a></li>
<li class="toctree-l1"><a class="reference internal" href="intersecting_cells.html">Intersecting cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="relax.html">Relax</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">soil_simulator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="body.html">Documentation for body objects</a></li>
      <li class="breadcrumb-item active">Determination of the body position</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/body_pos.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="determination-of-the-body-position">
<span id="body-pos"></span><h1>Determination of the body position<a class="headerlink" href="#determination-of-the-body-position" title="Permalink to this heading"></a></h1>
<p>The first task of the simulator is to determine the position of the simulated body within the 3D grid.
This is done by the <code class="code docutils literal notranslate"><span class="pre">CalcBodyPos</span></code> function in the <code class="code docutils literal notranslate"><span class="pre">body_pos.cpp</span></code> file.
Specifically, it aims to identify, for each XY position in the grid, the minimum and maximum height of the body walls if present at that location.
The algorithm used for this task has been optimized for performance, resulting in an efficient implementation.
However, due to the optimization, the algorithm may appear complex or unintuitive.</p>
<p>The basic idea under the implementation is to decompose the body into its different rigid surfaces, and to identify for each XY position of the grid the minimum and maximum height of the given body wall.
The results for the various surfaces are aggregated and sorted.
It is then straightforward to determine for each XY position the minimum and maximum height of the body using this information.
Note that only triangular and rectangular surfaces are currently supported.</p>
<p>A different implementation is present for rectangular and triangular surfaces.
However, as the algorithm behind these two implementations is almost identical, it can be described independently of the type of surface considered.
The position of the body wall is determined using a three-steps process:</p>
<ul class="simple">
<li><p>Each XY position within the bounding box of the body wall is decomposed into the reference vectors of the considered surface.
This allows to easily determine whether a given XY position falls inside or outside the projection of the body wall into the horizontal plane.</p></li>
<li><p>For each XY position (<code class="code docutils literal notranslate"><span class="pre">ii</span></code>, <code class="code docutils literal notranslate"><span class="pre">jj</span></code>) within the projection of the body wall into the horizontal plane, the height of the body wall at the cell corner (<code class="code docutils literal notranslate"><span class="pre">ii</span> <span class="pre">+</span> <span class="pre">0.5</span></code>, <code class="code docutils literal notranslate"><span class="pre">jj</span> <span class="pre">+</span> <span class="pre">0.5</span></code>) is calculated and added to the tally.
By iterating over all the cells, the algorithm ensures that the height of the body is calculated at the 4 corners of each cell within the projection of the body wall into the horizontal plane.
This is crucial because the minimum and maximum height of a plane intersecting laterally a cell is occurring necessarily at one of the cell’s corner.</p></li>
<li><p>An issue of this algorithm is that it does not handle the case where the body wall is either not fully intersecting the cell or intersecting vertically the cell.
Those cases are handled separately by identifying all the cells where the edges of the body wall are located.</p></li>
</ul>
<p>The algorithm to identify all the cells that lie on the edge of a body wall follow the implementations proposed by Amanatides and Woo in the article “A Fast Voxel Traversal Algorithm for Ray Tracing”.
The reader is invited to read this article for a detailed explanation of the algorithm, here only a general description will be given.
In this implementation, the gradient of the straight line is used to determine how long it is necessary to travel along the line before to cross a cell boundary in the three directions.
Knowing this information, it is then possible to travel along the line while identifying all the cell boundaries that are crossed.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="blade.html" class="btn btn-neutral float-left" title="Documentation for the bulldozer blade" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="body_soil.html" class="btn btn-neutral float-right" title="Documentation for the update of the soil resting on the body" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Vilella Kenny.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v1.1.1
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      <dd><a href="../v1.0.0/index.html">v1.0.0</a></dd>
      <dd><a href="../v1.1.0/body_pos.html">v1.1.0</a></dd>
      <dd><a href="body_pos.html">v1.1.1</a></dd>
      <dd><a href="../main/body_pos.html">main</a></dd>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>