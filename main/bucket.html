<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Documentation for the excavator bucket &mdash; soil_simulator  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation for the update of the soil resting on the body" href="body_soil.html" />
    <link rel="prev" title="Documentation for the simulation grid" href="grid.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            soil_simulator
          </a>
              <div class="version">
                0.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="grid.html">Grid</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bucket</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-description-of-the-simulated-excavator-bucket">General description of the simulated excavator bucket</a></li>
<li class="toctree-l2"><a class="reference internal" href="#determination-of-the-bucket-position">Determination of the bucket position</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="body_soil.html">Body soil</a></li>
<li class="toctree-l1"><a class="reference internal" href="intersecting_cells.html">Intersecting cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="relax.html">Relax</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">soil_simulator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Documentation for the excavator bucket</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/bucket.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="documentation-for-the-excavator-bucket">
<span id="bucket"></span><h1>Documentation for the excavator bucket<a class="headerlink" href="#documentation-for-the-excavator-bucket" title="Permalink to this heading"></a></h1>
<section id="general-description-of-the-simulated-excavator-bucket">
<h2>General description of the simulated excavator bucket<a class="headerlink" href="#general-description-of-the-simulated-excavator-bucket" title="Permalink to this heading"></a></h2>
<p>The excavator’s bucket has usually a complex shape that is not suitable for first-order modelling.
In this simulator, the bucket is approximated as a triangular prism to simplify its representation.
An illustration of the simulated bucket is provided below.</p>
<img alt="_images/bucket.png" src="_images/bucket.png" />
<p>The different parts of the bucket are labeled as follows:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">J</span></code> represents the bucket joint.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">B</span></code> represents the bucket base.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">T</span></code> represents the bucket teeth.</p></li>
<li><p>The surface defined by the vertices <span class="math notranslate nohighlight">\(T_lT_rB_rB_l\)</span> is referred to as the bucket base.</p></li>
<li><p>The surface defined by the vertices <span class="math notranslate nohighlight">\(J_lJ_rB_rB_l\)</span> is referred to as the bucket back.</p></li>
<li><p>The surface defined by the vertices <span class="math notranslate nohighlight">\(J_rB_rT_r\)</span> is referred to as the bucket right side.</p></li>
<li><p>The surface defined by the vertices <span class="math notranslate nohighlight">\(J_lB_lT_l\)</span> is referred to as the bucket left side.</p></li>
<li><p>The surface defined by the vertices <span class="math notranslate nohighlight">\(J_lJ_rT_rT_l\)</span> is referred to as the bucket front. Note that it does not correspond to a bucket wall.</p></li>
</ul>
<p>The reference pose of the bucket is specified when creating the <code class="code docutils literal notranslate"><span class="pre">Bucket</span></code> class and is defined by the fields <code class="code docutils literal notranslate"><span class="pre">j_pos_init_</span></code>, <code class="code docutils literal notranslate"><span class="pre">b_pos_init_</span></code>, and <code class="code docutils literal notranslate"><span class="pre">t_pos_init_</span></code>, which correspond to the positions of the bucket joint, base, and teeth, respectively.
The center of rotation for the bucket is typically the bucket joint, but it can be a different point depending on the specific bucket design.
In that case, a different bucket origin (<code class="code docutils literal notranslate"><span class="pre">o_pos_init</span></code>) can be provided when building <code class="code docutils literal notranslate"><span class="pre">Bucket</span></code>.
The position of the bucket joint, base, and teeth are generally defined relative to the bucket origin.</p>
<p>The pose of the bucket (<code class="code docutils literal notranslate"><span class="pre">pos_</span></code>) is provided to the simulator as the Cartesian position of the bucket origin and its orientation (<code class="code docutils literal notranslate"><span class="pre">ori_</span></code>) relative to the reference pose, using the <code class="code docutils literal notranslate"><span class="pre">Quaternion</span></code> notation.</p>
</section>
<section id="determination-of-the-bucket-position">
<h2>Determination of the bucket position<a class="headerlink" href="#determination-of-the-bucket-position" title="Permalink to this heading"></a></h2>
<p>The first task of the simulator is to determine the position of the excavator bucket within the 3D grid.
This is done by the <code class="code docutils literal notranslate"><span class="pre">CalcBucketPos</span></code> function in the <code class="code docutils literal notranslate"><span class="pre">bucket_pos.cpp</span></code> file.
Specifically, it aims to identify, for each XY position in the grid, the minimum and maximum height of the bucket walls if present at that location.
The algorithm used for this task has been optimized for performance, resulting in an efficient implementation.
However, due to the optimization, the algorithm may appear complex or unintuitive.</p>
<p>The basic idea under the implementation is to decompose the bucket into its 4 surfaces (base, back, left side, right side), and to identify for each XY position of the grid the minimum and maximum height of the given bucket wall.
The results for the four surfaces are then aggregated and sorted.
It is then straightforward to determine for each XY position the minimum and maximum height of the bucket using this information.
Although a different implementation is present for the rectangular surfaces (base and back) and for the triangular surfaces (left and right side), the algorithm is almost identical.</p>
<p>The position of the bucket wall is determined using a three-steps process:</p>
<ul class="simple">
<li><p>Each XY position within the bounding box of the bucket wall is decomposed into the reference vectors of the considered surface.
This allows to easily determine whether a given XY position falls inside or outside the projection of the bucket wall into the horizontal plane.</p></li>
<li><p>For each XY position (<code class="code docutils literal notranslate"><span class="pre">ii</span></code>, <code class="code docutils literal notranslate"><span class="pre">jj</span></code>) within the projection of the bucket wall into the horizontal plane, the height of the bucket wall at the cell corner (<code class="code docutils literal notranslate"><span class="pre">ii</span> <span class="pre">+</span> <span class="pre">0.5</span></code>, <code class="code docutils literal notranslate"><span class="pre">jj</span> <span class="pre">+</span> <span class="pre">0.5</span></code>) is calculated and added to the tally.
By iterating over all the cells, the algorithm ensures that the height of the bucket is calculated at the 4 corners of each cell within the projection of the bucket wall into the horizontal plane.
This is crucial because the minimum and maximum height of a plane intersecting laterally a cell is occurring necessarily at one of the cell’s corner.</p></li>
<li><p>An issue of this algorithm is that it does not handle the case where the bucket wall is either not fully intersecting the cell or intersecting vertically the cell.
Those cases are handled separately by identifying all the cells where the edges of the bucket wall are located.</p></li>
</ul>
<p>The algorithm to identify all the cells that lie on the edge of a bucket wall follow the implementations proposed by Amanatides and Woo in the article “A Fast Voxel Traversal Algorithm for Ray Tracing”.
The reader is invited to read this article for a detailed explanation of the algorithm, here only a general description will be given.
In this implementation, the gradient of the straight line is used to determine how long it is necessary to travel along the line before to cross a cell boundary in the three directions.
Knowing this information, it is then possible to travel along the line while identifying all the cell boundaries that are crossed.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="grid.html" class="btn btn-neutral float-left" title="Documentation for the simulation grid" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="body_soil.html" class="btn btn-neutral float-right" title="Documentation for the update of the soil resting on the body" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Vilella Kenny.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      <dd><a href="bucket.html">main</a></dd>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>